# Copyright 2022 The ChromiumOS Authors.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

package(default_visibility = [
    "//bazel/ebuild/private/common/hostcontainercomms:__subpackages__",
    "//bazel/ebuild/private/common/mountsdk:__pkg__",
])

go_library(
    name = "host",
    srcs = [
        "mountsdk_server.go",
        "server.go",
    ],
    data = [
        "//bazel/ebuild/private/common/hostcontainercomms/container:prep_client.sh",
        "//bazel/ebuild/private/common/hostcontainercomms/container/run_as_root",
    ],
    importpath = "cros.local/bazel/ebuild/private/common/hostcontainercomms/host",
    deps = [
        "//bazel/ebuild/private/common/hostcontainercomms:host_service",
        "//bazel/ebuild/private/common/makechroot",
        "//bazel/ebuild/private/common/mountsdk",
        "@io_bazel_rules_go//go/tools/bazel:go_default_library",
        "@org_golang_google_grpc//:go_default_library",
        "@org_golang_x_sys//unix",
    ],
)

go_test(
    name = "host_test",
    size = "small",
    srcs = ["mountsdk_server_test.go"],
    data = [
        "//bazel/sdk",
        "//bazel/sdk:base_sdk",
    ],
    deps = [
        ":host",
        "//bazel/ebuild/private/common/makechroot",
        "//bazel/ebuild/private/common/mountsdk",
        "@io_bazel_rules_go//go/tools/bazel:go_default_library",
    ],
)
