{{ copyright() }}

{{ autogenerated() }}

# Ensure that we don't mirror things that are already taken from GS buckets.
rewrite (storage.googleapis.com/.*) $1
rewrite (commondatastorage.googleapis.com/.*) $1

# We download the go registry from https://go.dev/dl/?mode=json&include=all
# It's constantly changing, but still downloaded with repository_ctx.download.
# Thus, we need it to go to the original location.
rewrite (go.dev/dl/\?mode=json&include=all) $1

rewrite (.*) commondatastorage.googleapis.com/chromeos-localmirror/cros-bazel/mirror/$1

{% if unmirrored == "MIRROR" %}
  {% if local_server is defined %}
rewrite (.*) {{ local_server }}/$1
  {% else %}
    {# This URL doesn't work yet #}
rewrite (.*) bazel-content-mirror.com/request_mirror/$1
  {% endif %}
block .*
{% elif unmirrored == "ALLOW" %}
rewrite (.*) $1
{% elif unmirrored == "BLOCK" %}
block .*
{% else %}
{{ fail("Invalid value for unmirrored: {}", unmirrored) }}
{% endif %}
