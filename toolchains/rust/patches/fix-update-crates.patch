From d2403042c71cac330c57df4e2c59f5a37223669c Mon Sep 17 00:00:00 2001
From: Matt Stark <msta@google.com>
Date: Thu, 29 Dec 2022 13:42:32 +1100
Subject: [PATCH] Ensure update_crates won't fail if the deps are out of date.

---
 crate_universe/src/rendering/templates/module_bzl.j2 | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/crate_universe/src/rendering/templates/module_bzl.j2 b/crate_universe/src/rendering/templates/module_bzl.j2
index ce39f7ab..07d526f1 100644
--- a/crate_universe/src/rendering/templates/module_bzl.j2
+++ b/crate_universe/src/rendering/templates/module_bzl.j2
@@ -196,7 +196,9 @@ def all_crate_deps(
 
     if not dependencies:
         if dependencies == None:
-            fail("Tried to get all_crate_deps for package " + package_name + " but that package had no Cargo.toml file")
+            # Leaving this on fail makes update_crates itself fail.
+            print("Tried to get all_crate_deps for package " + package_name + " but that package had no Cargo.toml file. Try running 'bazel run //bazel/toolchains/rust:update_crates'")
+            return []
         else:
             return []
 
-- 
2.39.0.314.g84b9a713c41-goog

